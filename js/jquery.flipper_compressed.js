(function(a){a.fn.Flipper=function(b){function s(a,b){var c={};for(var d in a){if(d in b){if(_.isObject(b[d])&&!_.isArray(b[d])){var e=s(a[d],b[d]);if(!_.isEmpty(e)){c[d]=e}}else if(!_.isEqual(a[d],b[d])){c[d]=b[d]}}}return c}function q(a,b,c){if(a<b){if(a+d.skipAnimationThreshold>b){return false}else{return true}}else{var e=c-a;if(e+b>d.skipAnimationThreshold){return true}else{return false}}}function p(a,b,c,d){var e=b.find(".top .panel");var f=b.find(".top .stationary-panel span");var g=b.find(".bottom .panel");var h=b.find(".bottom .stationary-panel span");if(c){e.find("span").text(a);g.find("span").text(a);f.text(a);h.text(a);setTimeout(function(){d.resolve()},50)}else{f.text(a);g.children("span").text(a);e.on("webkitAnimationEnd animationend",function(){e.removeClass("topFlipDown");e.children("span").text(a);g.addClass("bottomFlipDown")});g.on("webkitAnimationEnd animationend",function(){g.removeClass("bottomFlipDown");h.text(a);e.off("webkitAnimationEnd animationend");g.off("webkitAnimationEnd animationend");d.resolve()});e.addClass("topFlipDown")}}function o(b,c,e){var f=1;if(c===e){f=0}switch(f){case 0:break;case 1:var g=q(c,e,d.alphabet.length);c=d.alphabet[c+1]?c:-1;var h=d.alphabet[c+1];var i=a.Deferred();p(h,b,g,i);a.when(i).then(function(){c++;o(b,c,e)});break}}function n(a,b,c,d){setTimeout(function(){o(a,b,c)},d)}function m(b){var c=e.find(".flipper-container");for(i=0;i<b.length;i++){for(panelIndex in b[i]){var f=a(c[parseInt(panelIndex,10)+i*g[0].length]);var h=f.find("span").first().text();var j=b[i][panelIndex];var k=d.alphabet.indexOf(h);var l=d.alphabet.indexOf(j)===-1?0:d.alphabet.indexOf(j);if(d.dimensions[1]>1){var m=i*d.lineDelay;n(f,k,l,m)}else{o(f,k,l)}}}}function l(a){var b=d.dimensions[0];var c=d.dimensions[1];var e=[];var f=a.split(" ");var g=0;for(i=0;i<c;i++){var h=b;var j=[];var k=true;while(k){if(_.isString(f[g])&&f[g].length<=h){var l=[];for(charIndex in f[g]){j.push(f[g][charIndex])}h-=f[g].length;if(h!==0){j.push(" ");h--}g++}else if(h!==0){j.push(" ");h--}else{k=false}}e.push(j)}return e}function k(){var b=e.find(".panel-row");var c=[];a.each(b,function(){var b=a(this);var d=b.find(".top .stationary-panel span");var e=[];a.each(d,function(){var b=a(this);e.push(b.text())});c.push(e)});return c}var d={dimensions:null,alphabet:["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"," ",".","?","!","@","#",":",",",'"',"'","/",";","(",")","%","-","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],flipSpeed:50,fontSize:120,callback:function(){},align:"center",skipAnimationThreshold:5,lineDelay:500,textOffset:{h:0,v:0}};a.extend(d,b);var e=a(this);var f=0;var g=[];for(r=0;r<d.dimensions[1];r++){var h=jQuery('<div class="panel-row" />');e.append(h);g.push([]);for(c=0;c<d.dimensions[0];c++){var j=jQuery('<div class="flipper-container"><div class="pers-wrapper top"><div class="stationary-panel"><span></span></div><div class="panel"><span></span></div></div><div class="pers-wrapper bottom"><div class="stationary-panel"><span></span></div><div class="panel"><span></span></div></div></div>');h.append(j);g[r].push("");j.find("span").css({fontSize:d.fontSize});j.find(".bottom span").css({top:"-"+d.fontSize/1.5+"px"});j.find(".panel, .stationary-panel").css({height:d.fontSize/1.5,borderBottomWidth:Math.ceil(d.fontSize/1.5*.0322)});if(r===0&&c===0){j.find("span").text("W");f=j.find("span").first().width()}bRadius=f*.1;j.find(".top .panel, .top .stationary-panel").css({"-moz-border-radius-topleft":bRadius+"px","-moz-border-radius-topright":bRadius+"px","-webkit-border-radius":bRadius+"px "+bRadius+"px 0 0","border-radius":bRadius+"px "+bRadius+"px 0 0"});j.find(".bottom .panel, .bottom .stationary-panel").css({"-moz-border-radius-bottomleft":bRadius+"px","-moz-border-radius-bottomright":bRadius+"px","-webkit-border-radius":"0 0 "+bRadius+"px "+bRadius+"px","border-radius":"0 0 "+bRadius+"px "+bRadius+"px"});j.find("span").text(" ");j.find("span").css("width",f);j.find("span").css({top:d.textOffset.v>=0?"+="+d.textOffset.v+"px":"-="+Math.abs(d.textOffset.v)+"px",left:d.textOffset.h>=0?"+="+d.textOffset.h+"px":"-="+Math.abs(d.textOffset.h)+"px"})}}var t={updateString:function(a){var b=k();var c=l(a);var d=[];for(i=0;i<b.length;i++){d.push(s(b[i],c[i]))}m(d)},overrideWidth:function(b,c){if(_.isArray(b)){a.each(b,function(){var a;if(_.isString(this)){a=parseInt(this,10)}else{a=this}e.find(".flipper-container").eq(a).find("span").width(c)})}else{if(_.isString(b)){b=parseInt(b,10)}e.find(".flipper-container").eq(b).find("span").width(c)}}};t.updateString(d.text);a.when(this).then(function(){d.callback.apply()});return t}})(jQuery)

//     Underscore.js 1.3.0
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore is freely distributable under the MIT license.
//     Portions of Underscore are inspired or borrowed from Prototype,
//     Oliver Steele's Functional, and John Resig's Micro-Templating.
//     For all details and documentation:
//     http://documentcloud.github.com/underscore

(function(){function z(a,b,c){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a._chain)a=a._wrapped;if(b._chain)b=b._wrapped;if(a.isEqual&&w.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&w.isFunction(b.isEqual))return b.isEqual(a);var d=i.call(a);if(d!=i.call(b))return false;switch(d){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return false;var e=c.length;while(e--){if(c[e]==a)return true}c.push(a);var f=0,g=true;if(d=="[object Array]"){f=a.length;g=f==b.length;if(g){while(f--){if(!(g=f in a==f in b&&z(a[f],b[f],c)))break}}}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return false;for(var h in a){if(j.call(a,h)){f++;if(!(g=j.call(b,h)&&z(a[h],b[h],c)))break}}if(g){for(h in b){if(j.call(b,h)&&!(f--))break}g=!f}}c.pop();return g}var a=this;var b=a._;var c={};var d=Array.prototype,e=Object.prototype,f=Function.prototype;var g=d.slice,h=d.unshift,i=e.toString,j=e.hasOwnProperty;var k=d.forEach,l=d.map,m=d.reduce,n=d.reduceRight,o=d.filter,p=d.every,q=d.some,r=d.indexOf,s=d.lastIndexOf,t=Array.isArray,u=Object.keys,v=f.bind;var w=function(a){return new A(a)};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=w}exports._=w}else{a["_"]=w}w.VERSION="1.3.0";var x=w.each=w.forEach=function(a,b,d){if(a==null)return;if(k&&a.forEach===k){a.forEach(b,d)}else if(a.length===+a.length){for(var e=0,f=a.length;e<f;e++){if(e in a&&b.call(d,a[e],e,a)===c)return}}else{for(var g in a){if(j.call(a,g)){if(b.call(d,a[g],g,a)===c)return}}}};var y=function(){};w.isEqual=function(a,b){return z(a,b,[])};w.isEmpty=function(a){if(w.isArray(a)||w.isString(a))return a.length===0;for(var b in a)if(j.call(a,b))return false;return true};w.isArray=t||function(a){return i.call(a)=="[object Array]"};w.isObject=function(a){return a===Object(a)};w.isFunction=function(a){return i.call(a)=="[object Function]"};w.isString=function(a){return i.call(a)=="[object String]"};var A=function(a){this._wrapped=a};w.prototype=A.prototype;var B=function(a,b){return b?w(a).chain():a};var C=function(a,b){A.prototype[a]=function(){var a=g.call(arguments);h.call(a,this._wrapped);return B(b.apply(w,a),this._chain)}};w.mixin(w);x(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];A.prototype[a]=function(){var c=this._wrapped;b.apply(c,arguments);var d=c.length;if((a=="shift"||a=="splice")&&d===0)delete c[0];return B(c,this._chain)}});x(["concat","join","slice"],function(a){var b=d[a];A.prototype[a]=function(){return B(b.apply(this._wrapped,arguments),this._chain)}});A.prototype.chain=function(){this._chain=true;return this};A.prototype.value=function(){return this._wrapped}}).call(this)